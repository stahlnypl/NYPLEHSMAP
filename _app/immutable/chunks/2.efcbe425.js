import{s as At,n as We,o as Xt,f as Zt,b as Qt}from"./scheduler.b108d059.js";import{S as Ct,i as xt,g as ie,s as xe,m as ee,h as se,j as Le,f as ve,c as $e,y as dt,n as te,k as _e,a as $t,x as L,o as Fe,r as er,u as tr,v as rr,d as ir,t as sr,w as nr}from"./index.bb499846.js";import{_ as K}from"./preload-helper.41c905a7.js";import"./paths.849fead4.js";function or(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var ar=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const lr=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ar(void 0,void 0,void 0,function*(){return yield(yield K(()=>Promise.resolve().then(()=>Be),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)};class tt extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class cr extends tt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class hr extends tt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class dr extends tt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ur=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};class fr{constructor(e,{headers:t={},customFetch:r}={}){this.url=e,this.headers=t,this.fetch=lr(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return ur(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let a={},c;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):typeof o=="string"?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));const h=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:c}).catch(m=>{throw new cr(m)}),l=h.headers.get("x-relay-error");if(l&&l==="true")throw new hr(h);if(!h.ok)throw new dr(h);let f=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),v;return f==="application/json"?v=yield h.json():f==="application/octet-stream"?v=yield h.blob():f==="multipart/form-data"?v=yield h.formData():v=yield h.text(),{data:v,error:null}}catch(s){return{data:null,error:s}}})}}var pr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ye={exports:{}};(function(n,e){var t=typeof self<"u"?self:pr,r=function(){function i(){this.fetch=!1,this.DOMException=t.DOMException}return i.prototype=t,new i}();(function(i){(function(o){var a={searchParams:"URLSearchParams"in i,iterable:"Symbol"in i&&"iterator"in Symbol,blob:"FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in i,arrayBuffer:"ArrayBuffer"in i};function c(d){return d&&DataView.prototype.isPrototypeOf(d)}if(a.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(d){return d&&h.indexOf(Object.prototype.toString.call(d))>-1};function f(d){if(typeof d!="string"&&(d=String(d)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(d))throw new TypeError("Invalid character in header field name");return d.toLowerCase()}function v(d){return typeof d!="string"&&(d=String(d)),d}function m(d){var p={next:function(){var T=d.shift();return{done:T===void 0,value:T}}};return a.iterable&&(p[Symbol.iterator]=function(){return p}),p}function g(d){this.map={},d instanceof g?d.forEach(function(p,T){this.append(T,p)},this):Array.isArray(d)?d.forEach(function(p){this.append(p[0],p[1])},this):d&&Object.getOwnPropertyNames(d).forEach(function(p){this.append(p,d[p])},this)}g.prototype.append=function(d,p){d=f(d),p=v(p);var T=this.map[d];this.map[d]=T?T+", "+p:p},g.prototype.delete=function(d){delete this.map[f(d)]},g.prototype.get=function(d){return d=f(d),this.has(d)?this.map[d]:null},g.prototype.has=function(d){return this.map.hasOwnProperty(f(d))},g.prototype.set=function(d,p){this.map[f(d)]=v(p)},g.prototype.forEach=function(d,p){for(var T in this.map)this.map.hasOwnProperty(T)&&d.call(p,this.map[T],T,this)},g.prototype.keys=function(){var d=[];return this.forEach(function(p,T){d.push(T)}),m(d)},g.prototype.values=function(){var d=[];return this.forEach(function(p){d.push(p)}),m(d)},g.prototype.entries=function(){var d=[];return this.forEach(function(p,T){d.push([T,p])}),m(d)},a.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function _(d){if(d.bodyUsed)return Promise.reject(new TypeError("Already read"));d.bodyUsed=!0}function S(d){return new Promise(function(p,T){d.onload=function(){p(d.result)},d.onerror=function(){T(d.error)}})}function C(d){var p=new FileReader,T=S(p);return p.readAsArrayBuffer(d),T}function j(d){var p=new FileReader,T=S(p);return p.readAsText(d),T}function R(d){for(var p=new Uint8Array(d),T=new Array(p.length),I=0;I<p.length;I++)T[I]=String.fromCharCode(p[I]);return T.join("")}function P(d){if(d.slice)return d.slice(0);var p=new Uint8Array(d.byteLength);return p.set(new Uint8Array(d)),p.buffer}function N(){return this.bodyUsed=!1,this._initBody=function(d){this._bodyInit=d,d?typeof d=="string"?this._bodyText=d:a.blob&&Blob.prototype.isPrototypeOf(d)?this._bodyBlob=d:a.formData&&FormData.prototype.isPrototypeOf(d)?this._bodyFormData=d:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(d)?this._bodyText=d.toString():a.arrayBuffer&&a.blob&&c(d)?(this._bodyArrayBuffer=P(d.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(d)||l(d))?this._bodyArrayBuffer=P(d):this._bodyText=d=Object.prototype.toString.call(d):this._bodyText="",this.headers.get("content-type")||(typeof d=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(d)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var d=_(this);if(d)return d;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?_(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(C)}),this.text=function(){var d=_(this);if(d)return d;if(this._bodyBlob)return j(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(R(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(B)}),this.json=function(){return this.text().then(JSON.parse)},this}var Z=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function F(d){var p=d.toUpperCase();return Z.indexOf(p)>-1?p:d}function $(d,p){p=p||{};var T=p.body;if(d instanceof $){if(d.bodyUsed)throw new TypeError("Already read");this.url=d.url,this.credentials=d.credentials,p.headers||(this.headers=new g(d.headers)),this.method=d.method,this.mode=d.mode,this.signal=d.signal,!T&&d._bodyInit!=null&&(T=d._bodyInit,d.bodyUsed=!0)}else this.url=String(d);if(this.credentials=p.credentials||this.credentials||"same-origin",(p.headers||!this.headers)&&(this.headers=new g(p.headers)),this.method=F(p.method||this.method||"GET"),this.mode=p.mode||this.mode||null,this.signal=p.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&T)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(T)}$.prototype.clone=function(){return new $(this,{body:this._bodyInit})};function B(d){var p=new FormData;return d.trim().split("&").forEach(function(T){if(T){var I=T.split("="),b=I.shift().replace(/\+/g," "),E=I.join("=").replace(/\+/g," ");p.append(decodeURIComponent(b),decodeURIComponent(E))}}),p}function Ae(d){var p=new g,T=d.replace(/\r?\n[\t ]+/g," ");return T.split(/\r?\n/).forEach(function(I){var b=I.split(":"),E=b.shift().trim();if(E){var ce=b.join(":").trim();p.append(E,ce)}}),p}N.call($.prototype);function H(d,p){p||(p={}),this.type="default",this.status=p.status===void 0?200:p.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in p?p.statusText:"OK",this.headers=new g(p.headers),this.url=p.url||"",this._initBody(d)}N.call(H.prototype),H.prototype.clone=function(){return new H(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},H.error=function(){var d=new H(null,{status:0,statusText:""});return d.type="error",d};var Ce=[301,302,303,307,308];H.redirect=function(d,p){if(Ce.indexOf(p)===-1)throw new RangeError("Invalid status code");return new H(null,{status:p,headers:{location:d}})},o.DOMException=i.DOMException;try{new o.DOMException}catch{o.DOMException=function(p,T){this.message=p,this.name=T;var I=Error(p);this.stack=I.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function me(d,p){return new Promise(function(T,I){var b=new $(d,p);if(b.signal&&b.signal.aborted)return I(new o.DOMException("Aborted","AbortError"));var E=new XMLHttpRequest;function ce(){E.abort()}E.onload=function(){var Q={status:E.status,statusText:E.statusText,headers:Ae(E.getAllResponseHeaders()||"")};Q.url="responseURL"in E?E.responseURL:Q.headers.get("X-Request-URL");var be="response"in E?E.response:E.responseText;T(new H(be,Q))},E.onerror=function(){I(new TypeError("Network request failed"))},E.ontimeout=function(){I(new TypeError("Network request failed"))},E.onabort=function(){I(new o.DOMException("Aborted","AbortError"))},E.open(b.method,b.url,!0),b.credentials==="include"?E.withCredentials=!0:b.credentials==="omit"&&(E.withCredentials=!1),"responseType"in E&&a.blob&&(E.responseType="blob"),b.headers.forEach(function(Q,be){E.setRequestHeader(be,Q)}),b.signal&&(b.signal.addEventListener("abort",ce),E.onreadystatechange=function(){E.readyState===4&&b.signal.removeEventListener("abort",ce)}),E.send(typeof b._bodyInit>"u"?null:b._bodyInit)})}return me.polyfill=!0,i.fetch||(i.fetch=me,i.Headers=g,i.Request=$,i.Response=H),o.Headers=g,o.Request=$,o.Response=H,o.fetch=me,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var s=r;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,n.exports=e})(Ye,Ye.exports);var rt=Ye.exports;const it=vr(rt),Be=or({__proto__:null,default:it},[rt]);class yr{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=it:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,a,c;let h=null,l=null,f=null,v=i.status,m=i.statusText;if(i.ok){if(this.method!=="HEAD"){const C=await i.text();C===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?l=C:l=JSON.parse(C))}const _=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),S=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");_&&S&&S.length>1&&(f=parseInt(S[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(l)&&(l.length>1?(h={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,f=null,v=406,m="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{const _=await i.text();try{h=JSON.parse(_),Array.isArray(h)&&i.status===404&&(l=[],h=null,v=200,m="OK")}catch{i.status===404&&_===""?(v=204,m="No Content"):h={message:_}}if(h&&this.isMaybeSingle&&(!((c=h==null?void 0:h.details)===null||c===void 0)&&c.includes("Results contain 0 rows"))&&(h=null,v=200,m="OK"),h&&this.shouldThrowOnError)throw h}return{error:h,data:l,count:f,status:v,statusText:m}});return this.shouldThrowOnError||(s=s.catch(i=>{var o,a,c;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(a=i==null?void 0:i.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}}class gr extends yr{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){const r=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){const s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:o="text"}={}){const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${c}"; options=${a};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class pe extends gr{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=t.map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){const r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class mr{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new pe({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){const a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new pe({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const c=e.reduce((h,l)=>h.concat(Object.keys(l)),[]);if(c.length>0){const h=[...new Set(c)].map(l=>`"${l}"`);this.url.searchParams.set("columns",h.join(","))}}return new pe({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new pe({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new pe({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const br="1.7.1",_r={"X-Client-Info":`postgrest-js/${br}`};class wr{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},_r),t),this.schema=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new mr(t,{headers:Object.assign({},this.headers),schema:this.schema,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:s}={}){let i;const o=new URL(`${this.url}/rpc/${e}`);let a;r?(i="HEAD",Object.entries(t).forEach(([h,l])=>{o.searchParams.append(h,`${l}`)})):(i="POST",a=t);const c=Object.assign({},this.headers);return s&&(c.Prefer=`count=${s}`),new pe({method:i,url:o,headers:c,schema:this.schema,body:a,fetch:this.fetch,allowEmpty:!1})}}var He,ut;function Tr(){if(ut)return He;ut=1;var n=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return He=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}(),He}const Sr="websocket",kr="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",Er=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],Or="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",Ar=["IÃ±aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],Cr="1.0.34",xr={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},$r="https://github.com/theturtle32/WebSocket-Node",Pr={node:">=4.0.0"},jr={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},Rr={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},Ir={verbose:!1},Dr={test:"tape test/unit/*.js",gulp:"gulp"},Lr="index",Ur={lib:"./lib"},Br="lib/browser.js",Mr="Apache-2.0",Nr={name:Sr,description:kr,keywords:Er,author:Or,contributors:Ar,version:Cr,repository:xr,homepage:$r,engines:Pr,dependencies:jr,devDependencies:Rr,config:Ir,scripts:Dr,main:Lr,directories:Ur,browser:Br,license:Mr};var Fr=Nr.version,ne;if(typeof globalThis=="object")ne=globalThis;else try{ne=Tr()}catch{}finally{if(!ne&&typeof window<"u"&&(ne=window),!ne)throw new Error("Could not determine global this")}var Ee=ne.WebSocket||ne.MozWebSocket,Hr=Fr;function Pt(n,e){var t;return e?t=new Ee(n,e):t=new Ee(n),t}Ee&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(Pt,n,{get:function(){return Ee[n]}})});var Gr={w3cwebsocket:Ee?Pt:null,version:Hr};const qr="2.7.3",zr={"X-Client-Info":`realtime-js/${qr}`},Jr="1.0.0",jt=1e4,Kr=1e3;var Se;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Se||(Se={}));var G;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(G||(G={}));var z;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(z||(z={}));var Xe;(function(n){n.websocket="websocket"})(Xe||(Xe={}));var oe;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(oe||(oe={}));class Rt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class Vr{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const c=r.decode(e.slice(o,o+i));o=o+i;const h=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:h}}}class Ge{constructor(e,t,r={},s=jt){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ft;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(ft||(ft={}));class ke{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ke.syncState(this.state,s,i,o),this.pendingDiffs.forEach(c=>{this.state=ke.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=ke.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(i,(h,l)=>{o[h]||(c[h]=l)}),this.map(o,(h,l)=>{const f=i[h];if(f){const v=l.map(S=>S.presence_ref),m=f.map(S=>S.presence_ref),g=l.filter(S=>m.indexOf(S.presence_ref)<0),_=f.filter(S=>v.indexOf(S.presence_ref)<0);g.length>0&&(a[h]=g),_.length>0&&(c[h]=_)}else a[h]=l}),this.syncDiff(i,{joins:a,leaves:c},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,c)=>{var h;const l=(h=e[a])!==null&&h!==void 0?h:[];if(e[a]=this.cloneDeep(c),l.length>0){const f=e[a].map(m=>m.presence_ref),v=l.filter(m=>f.indexOf(m.presence_ref)<0);e[a].unshift(...v)}r(a,l,c)}),this.map(o,(a,c)=>{let h=e[a];if(!h)return;const l=c.map(f=>f.presence_ref);h=h.filter(f=>l.indexOf(f.presence_ref)<0),e[a]=h,s(a,h,c),h.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var x;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(x||(x={}));const pt=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=Wr(o,n,e,s),i),{})},Wr=(n,e,t,r)=>{const s=e.find(a=>a.name===n),i=s==null?void 0:s.type,o=t[n];return i&&!r.includes(i)?It(i,o):Ze(o)},It=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Qr(e,t)}switch(n){case x.bool:return Yr(e);case x.float4:case x.float8:case x.int2:case x.int4:case x.int8:case x.numeric:case x.oid:return Xr(e);case x.json:case x.jsonb:return Zr(e);case x.timestamp:return ei(e);case x.abstime:case x.date:case x.daterange:case x.int4range:case x.int8range:case x.money:case x.reltime:case x.text:case x.time:case x.timestamptz:case x.timetz:case x.tsrange:case x.tstzrange:return Ze(e);default:return Ze(e)}},Ze=n=>n,Yr=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Xr=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Zr=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Qr=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>It(e,a))}return n},ei=n=>typeof n=="string"?n.replace(" ","T"):n;var vt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})},yt;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(yt||(yt={}));var gt;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes"})(gt||(gt={}));var mt;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(mt||(mt={}));class st{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=G.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ge(this,z.join,this.params,this.timeout),this.rejoinTimer=new Rt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=G.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=G.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=G.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=G.errored,this.rejoinTimer.scheduleTimeout())}),this._on(z.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new ke(this)}subscribe(e,t=this.timeout){var r,s;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o}}=this.params;this._onError(h=>e&&e("CHANNEL_ERROR",h)),this._onClose(()=>e&&e("CLOSED"));const a={},c={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(h=>h.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:c},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:h})=>{var l;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),h===void 0){e&&e("SUBSCRIBED");return}else{const f=this.bindings.postgres_changes,v=(l=f==null?void 0:f.length)!==null&&l!==void 0?l:0,m=[];for(let g=0;g<v;g++){const _=f[g],{filter:{event:S,schema:C,table:j,filter:R}}=_,P=h&&h[g];if(P&&P.event===S&&P.schema===C&&P.table===j&&P.filter===R)m.push(Object.assign(Object.assign({},_),{id:P.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,e&&e("SUBSCRIBED");return}}).receive("error",h=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(e,t={}){return vt(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(e={}){return vt(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this._on(e,t,r)}send(e,t={}){return new Promise(r=>{var s,i,o;const a=this._push(e.type,e,t.timeout||this.timeout);a.rateLimited&&r("rate limited"),e.type==="broadcast"&&!(!((o=(i=(s=this.params)===null||s===void 0?void 0:s.config)===null||i===void 0?void 0:i.broadcast)===null||o===void 0)&&o.ack)&&r("ok"),a.receive("ok",()=>r("ok")),a.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=G.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(z.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new Ge(this,z.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Ge(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:h,join:l}=z;if(r&&[a,c,h,l].indexOf(o)>=0&&r!==this._joinRef())return;let v=this._onMessage(o,t,r);if(t&&!v)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(m=>{var g,_,S;return((g=m.filter)===null||g===void 0?void 0:g.event)==="*"||((S=(_=m.filter)===null||_===void 0?void 0:_.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===o}).map(m=>m.callback(v,r)):(i=this.bindings[o])===null||i===void 0||i.filter(m=>{var g,_,S,C,j,R;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in m){const P=m.id,N=(g=m.filter)===null||g===void 0?void 0:g.event;return P&&((_=t.ids)===null||_===void 0?void 0:_.includes(P))&&(N==="*"||(N==null?void 0:N.toLocaleLowerCase())===((S=t.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const P=(j=(C=m==null?void 0:m.filter)===null||C===void 0?void 0:C.event)===null||j===void 0?void 0:j.toLocaleLowerCase();return P==="*"||P===((R=t==null?void 0:t.event)===null||R===void 0?void 0:R.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===o}).map(m=>{if(typeof v=="object"&&"ids"in v){const g=v.data,{schema:_,table:S,commit_timestamp:C,type:j,errors:R}=g;v=Object.assign(Object.assign({},{schema:_,table:S,commit_timestamp:C,eventType:j,new:{},old:{},errors:R}),this._getPayloadRecords(g))}m.callback(v,r)})}_isClosed(){return this.state===G.closed}_isJoined(){return this.state===G.joined}_isJoining(){return this.state===G.joining}_isLeaving(){return this.state===G.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&st.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(z.close,{},e)}_onError(e){this._on(z.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=G.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=pt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=pt(e.columns,e.old_record)),t}}var qe=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const ti=()=>{};class ri{constructor(e,t){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=zr,this.params={},this.timeout=jt,this.transport=Gr.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=ti,this.conn=null,this.sendBuffer=[],this.serializer=new Vr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${Xe.websocket}`,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.transport&&(this.transport=t.transport),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.eventsPerSecond;s&&(this.eventsPerSecondLimitMs=Math.floor(1e3/s)),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Rt(()=>qe(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return qe(this,void 0,void 0,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return qe(this,void 0,void 0,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Se.connecting:return oe.Connecting;case Se.open:return oe.Open;case Se.closing:return oe.Closing;default:return oe.Closed}}isConnected(){return this.connectionState()===oe.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();const r=new st(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e;let o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};if(this.log("push",`${t} ${r} (${i})`,s),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(r)){if(this._throttle(o)())return"rate limited"}else o();else this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(z.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Jr}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:o}=t;(o&&o===this.pendingHeartbeatRef||s===(i==null?void 0:i.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(z.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Kr,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}}class nt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function U(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class ii extends nt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class bt extends nt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Dt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const Lt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Dt(void 0,void 0,void 0,function*(){return yield(yield K(()=>Promise.resolve().then(()=>Be),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)},si=()=>Dt(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield K(()=>Promise.resolve().then(()=>Be),void 0,import.meta.url)).Response:Response});var ye=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const ze=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),ni=(n,e)=>ye(void 0,void 0,void 0,function*(){const t=yield si();n instanceof t?n.json().then(r=>{e(new ii(ze(r),n.status||500))}).catch(r=>{e(new bt(ze(r),r))}):e(new bt(ze(n),n))}),oi=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function Me(n,e,t,r,s,i){return ye(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,oi(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>ni(c,a))})})}function Qe(n,e,t,r){return ye(this,void 0,void 0,function*(){return Me(n,"GET",e,t,r)})}function X(n,e,t,r,s){return ye(this,void 0,void 0,function*(){return Me(n,"POST",e,r,s,t)})}function ai(n,e,t,r,s){return ye(this,void 0,void 0,function*(){return Me(n,"PUT",e,r,s,t)})}function Ut(n,e,t,r,s){return ye(this,void 0,void 0,function*(){return Me(n,"DELETE",e,r,s,t)})}var q=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const li={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},_t={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ci{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Lt(s)}uploadOrUpdate(e,t,r,s){return q(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},_t),s),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl)):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const c=this._removeEmptyFolders(t),h=this._getFinalPath(c),l=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:i,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return l.ok?{data:{path:c},error:null}:{data:null,error:yield l.json()}}catch(i){if(U(i))return{data:null,error:i};throw i}})}upload(e,t,r){return q(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return q(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c;const h=Object.assign({upsert:_t.upsert},s),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",h.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",h.cacheControl)):(c=r,l["cache-control"]=`max-age=${h.cacheControl}`,l["content-type"]=h.contentType);const f=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:l});return f.ok?{data:{path:i},error:null}:{data:null,error:yield f.json()}}catch(c){if(U(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e){return q(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield X(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+r.url),i=s.searchParams.get("token");if(!i)throw new nt("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:i},error:null}}catch(t){if(U(t))return{data:null,error:t};throw t}})}update(e,t,r){return q(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return q(this,void 0,void 0,function*(){try{return{data:yield X(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(U(r))return{data:null,error:r};throw r}})}copy(e,t){return q(this,void 0,void 0,function*(){try{return{data:{path:(yield X(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(U(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return q(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield X(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(U(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return q(this,void 0,void 0,function*(){try{const s=yield X(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(U(s))return{data:null,error:s};throw s}})}download(e,t){return q(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Qe(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(U(a))return{data:null,error:a};throw a}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&s.push(c);let h=s.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${h}`)}}}remove(e){return q(this,void 0,void 0,function*(){try{return{data:yield Ut(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(U(t))return{data:null,error:t};throw t}})}list(e,t,r){return q(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},li),t),{prefix:e||""});return{data:yield X(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(U(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const hi="2.5.1",di={"X-Client-Info":`storage-js/${hi}`};var ue=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};class ui{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},di),t),this.fetch=Lt(r)}listBuckets(){return ue(this,void 0,void 0,function*(){try{return{data:yield Qe(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(U(e))return{data:null,error:e};throw e}})}getBucket(e){return ue(this,void 0,void 0,function*(){try{return{data:yield Qe(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(U(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ue(this,void 0,void 0,function*(){try{return{data:yield X(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(U(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ue(this,void 0,void 0,function*(){try{return{data:yield ai(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(U(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ue(this,void 0,void 0,function*(){try{return{data:yield X(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(U(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ue(this,void 0,void 0,function*(){try{return{data:yield Ut(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(U(t))return{data:null,error:t};throw t}})}}class fi extends ui{constructor(e,t={},r){super(e,t,r)}from(e){return new ci(this.url,this.headers,e,this.fetch)}}const pi="2.26.0",vi={"X-Client-Info":`supabase-js/${pi}`};var yi=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const gi=n=>{let e;return n?e=n:typeof fetch>"u"?e=it:e=fetch,(...t)=>e(...t)},mi=()=>typeof Headers>"u"?rt.Headers:Headers,bi=(n,e,t)=>{const r=gi(t),s=mi();return(i,o)=>yi(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:n;let h=new s(o==null?void 0:o.headers);return h.has("apikey")||h.set("apikey",n),h.has("Authorization")||h.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:h}))})};function _i(n){return n.replace(/\/$/,"")}function wi(n,e){const{db:t,auth:r,realtime:s,global:i}=n,{db:o,auth:a,realtime:c,global:h}=e;return{db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},h),i)}}var le=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};function Ti(n){return Math.round(Date.now()/1e3)+n}function Si(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const W=()=>typeof document<"u",re={tested:!1,writable:!1},Ue=()=>{if(!W())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(re.tested)return re.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),re.tested=!0,re.writable=!0}catch{re.tested=!0,re.writable=!1}return re.writable};function M(n,e){var t;e||(e=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.href)||""),n=n.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+n+"(=([^&#]*)|&|#|$)"),s=r.exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}const Bt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>le(void 0,void 0,void 0,function*(){return yield(yield K(()=>Promise.resolve().then(()=>Be),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)},ki=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",we=(n,e,t)=>le(void 0,void 0,void 0,function*(){yield n.setItem(e,JSON.stringify(t))}),Pe=(n,e)=>le(void 0,void 0,void 0,function*(){const t=yield n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}}),Je=(n,e)=>le(void 0,void 0,void 0,function*(){yield n.removeItem(e)});function Ei(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,i,o,a,c,h,l=0;for(n=n.replace("-","+").replace("_","/");l<n.length;)o=e.indexOf(n.charAt(l++)),a=e.indexOf(n.charAt(l++)),c=e.indexOf(n.charAt(l++)),h=e.indexOf(n.charAt(l++)),r=o<<2|a>>4,s=(a&15)<<4|c>>2,i=(c&3)<<6|h,t=t+String.fromCharCode(r),c!=64&&s!=0&&(t=t+String.fromCharCode(s)),h!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class Ne{constructor(){this.promise=new Ne.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ne.promiseConstructor=Promise;function wt(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(Ei(r))}function Oi(n){return new Promise(e=>{setTimeout(()=>e(null),n)})}function Ai(n,e){return new Promise((r,s)=>{le(this,void 0,void 0,function*(){for(let i=0;i<1/0;i++)try{const o=yield n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})})}function Ci(n){return("0"+n.toString(16)).substr(-2)}function je(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,Ci).join("")}function xi(n){return le(this,void 0,void 0,function*(){const t=new TextEncoder().encode(n),r=yield crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")})}function $i(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function Re(n){return le(this,void 0,void 0,function*(){if(typeof crypto>"u")return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const e=yield xi(n);return $i(e)})}class ot extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function k(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Pi extends ot{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function ji(n){return k(n)&&n.name==="AuthApiError"}class Mt extends ot{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ge extends ot{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class fe extends ge{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Ke extends ge{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Ie extends ge{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class V extends ge{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ve extends ge{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class et extends ge{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function Tt(n){return k(n)&&n.name==="AuthRetryableFetchError"}var at=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})},Ri=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const Te=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ii=[502,503,504];function St(n){return at(this,void 0,void 0,function*(){if(!ki(n))throw new et(Te(n),0);if(Ii.includes(n.status))throw new et(Te(n),n.status);let e;try{e=yield n.json()}catch(t){throw new Mt(Te(t),t)}throw new Pi(Te(e),n.status||500)})}const Di=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function O(n,e,t,r){var s;return at(this,void 0,void 0,function*(){const i=Object.assign({},r==null?void 0:r.headers);r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=yield Li(n,e,t+a,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}})}function Li(n,e,t,r,s,i){return at(this,void 0,void 0,function*(){const o=Di(e,r,s,i);let a;try{a=yield n(t,o)}catch(c){throw console.error(c),new et(Te(c),0)}if(a.ok||(yield St(a)),r!=null&&r.noResolveJson)return a;try{return yield a.json()}catch(c){yield St(c)}})}function Y(n){var e;let t=null;Ni(n)&&(t=Object.assign({},n),t.expires_at=Ti(n.expires_in));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function ae(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Ui(n){return{data:n,error:null}}function Bi(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=Ri(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function Mi(n){return n}function Ni(n){return n.access_token&&n.refresh_token&&n.expires_in}var J=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})},Fi=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Hi{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Bt(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e,t="global"){return J(this,void 0,void 0,function*(){try{return yield O(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(k(r))return{data:null,error:r};throw r}})}inviteUserByEmail(e,t={}){return J(this,void 0,void 0,function*(){try{return yield O(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ae})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}generateLink(e){return J(this,void 0,void 0,function*(){try{const{options:t}=e,r=Fi(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),yield O(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Bi,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(k(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return J(this,void 0,void 0,function*(){try{return yield O(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ae})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}})}listUsers(e){var t,r,s,i,o,a,c;return J(this,void 0,void 0,function*(){try{const h={nextPage:null,lastPage:0,total:0},l=yield O(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Mi});if(l.error)throw l.error;const f=yield l.json(),v=(o=l.headers.get("x-total-count"))!==null&&o!==void 0?o:0,m=(c=(a=l.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(g=>{const _=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(g.split(";")[1].split("=")[1]);h[`${S}Page`]=_}),h.total=parseInt(v)),{data:Object.assign(Object.assign({},f),h),error:null}}catch(h){if(k(h))return{data:{users:[]},error:h};throw h}})}getUserById(e){return J(this,void 0,void 0,function*(){try{return yield O(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ae})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return J(this,void 0,void 0,function*(){try{return yield O(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ae})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}deleteUser(e,t=!1){return J(this,void 0,void 0,function*(){try{return yield O(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ae})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}_listFactors(e){return J(this,void 0,void 0,function*(){try{const{data:t,error:r}=yield O(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(k(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return J(this,void 0,void 0,function*(){try{return{data:yield O(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}})}}const Gi="2.39.0",qi="http://localhost:9999",zi="supabase.auth.token",Ji={"X-Client-Info":`gotrue-js/${Gi}`},kt=10,Et={getItem:n=>Ue()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Ue()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Ue()&&globalThis.localStorage.removeItem(n)}};function Ki(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var w=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};Ki();const Vi={url:qi,storageKey:zi,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ji,flowType:"implicit",debug:!1},De=30*1e3,Ot=3;class Oe{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null,this.instanceID=Oe.nextInstanceID,Oe.nextInstanceID+=1,this.instanceID>0&&W()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},Vi),e);if(this.logDebugMessages=r.debug,this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||Et,this.admin=new Hi({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Bt(r.fetch),this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===Et&&!Ue()&&console.warn(`No storage option exists to persist the session, which may result in unexpected behavior when using auth.
        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning.`),W()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(t=this.broadcastChannel)===null||t===void 0||t.addEventListener("message",s=>w(this,void 0,void 0,function*(){this._debug("received broadcast notification from other tab or client",s),yield this._notifyAllSubscribers(s.data.event,s.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&console.log(`GoTrueClient@${this.instanceID} ${new Date().toISOString()}`,...e),this}initialize(){return this.initializePromise||(this.initializePromise=this._initialize()),this.initializePromise}_initialize(){return w(this,void 0,void 0,function*(){if(this.initializePromise)return this.initializePromise;try{const e=W()?yield this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=yield this._getSessionFromUrl(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),yield this._removeSession(),{error:r};const{session:s,redirectType:i}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",i),yield this._saveSession(s),setTimeout(()=>w(this,void 0,void 0,function*(){i==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",s):yield this._notifyAllSubscribers("SIGNED_IN",s)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(e){return k(e)?{error:e}:{error:new Mt("Unexpected error during initialization",e)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signUp(e){var t,r,s;return w(this,void 0,void 0,function*(){try{yield this._removeSession();let i;if("email"in e){const{email:l,password:f,options:v}=e;let m=null,g=null;if(this.flowType==="pkce"){const _=je();yield we(this.storage,`${this.storageKey}-code-verifier`,_),m=yield Re(_),g=_===m?"plain":"s256"}i=yield O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:v==null?void 0:v.emailRedirectTo,body:{email:l,password:f,data:(t=v==null?void 0:v.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken},code_challenge:m,code_challenge_method:g},xform:Y})}else if("phone"in e){const{phone:l,password:f,options:v}=e;i=yield O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:l,password:f,data:(r=v==null?void 0:v.data)!==null&&r!==void 0?r:{},channel:(s=v==null?void 0:v.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}},xform:Y})}else throw new Ie("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,h=o.user;return o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:h,session:c},error:null}}catch(i){if(k(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithPassword(e){return w(this,void 0,void 0,function*(){try{yield this._removeSession();let t;if("email"in e){const{email:i,password:o,options:a}=e;t=yield O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Y})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=yield O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Y})}else throw new Ie("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ke}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:s})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){var t,r,s,i;return w(this,void 0,void 0,function*(){return yield this._removeSession(),yield this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})})}exchangeCodeForSession(e){return w(this,void 0,void 0,function*(){const t=yield Pe(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:s}=yield O(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:Y});return yield Je(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ke}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s})})}signInWithIdToken(e){return w(this,void 0,void 0,function*(){yield this._removeSession();try{const{options:t,provider:r,token:s,access_token:i,nonce:o}=e,a=yield O(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Y}),{data:c,error:h}=a;return h?{data:{user:null,session:null},error:h}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Ke}:(c.session&&(yield this._saveSession(c.session),yield this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:h})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){var t,r,s,i,o;return w(this,void 0,void 0,function*(){try{if(yield this._removeSession(),"email"in e){const{email:a,options:c}=e;let h=null,l=null;if(this.flowType==="pkce"){const v=je();yield we(this.storage,`${this.storageKey}-code-verifier`,v),h=yield Re(v),l=v===h?"plain":"s256"}const{error:f}=yield O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:h,code_challenge_method:l},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in e){const{phone:a,options:c}=e,{data:h,error:l}=yield O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:l}}throw new Ie("You must provide either an email or phone number.")}catch(a){if(k(a))return{data:{user:null,session:null},error:a};throw a}})}verifyOtp(e){var t,r;return w(this,void 0,void 0,function*(){try{e.type!=="email_change"&&e.type!=="phone_change"&&(yield this._removeSession());const{data:s,error:i}=yield O(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:(t=e.options)===null||t===void 0?void 0:t.captchaToken}}),redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,xform:Y});if(i)throw i;if(!s)throw new Error("An error occurred on token verification.");const o=s.session,a=s.user;return o!=null&&o.access_token&&(yield this._saveSession(o),yield this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:a,session:o},error:null}}catch(s){if(k(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithSSO(e){var t,r,s;return w(this,void 0,void 0,function*(){try{return yield this._removeSession(),yield O(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:Ui})}catch(i){if(k(i))return{data:null,error:i};throw i}})}reauthenticate(){return w(this,void 0,void 0,function*(){try{const{data:{session:e},error:t}=yield this.getSession();if(t)throw t;if(!e)throw new fe;const{error:r}=yield O(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:r}}catch(e){if(k(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return w(this,void 0,void 0,function*(){try{yield this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=yield O(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=yield O(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new Ie("You must provide either an email or phone number and a type")}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return w(this,void 0,void 0,function*(){yield this.initializePromise,this._debug("#getSession()","begin");try{let e=null;if(this.persistSession){const i=yield Pe(this.storage,this.storageKey);this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?e=i:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession()))}else e=this.inMemorySession,this._debug("#getSession()","session from memory",e);if(!e)return{data:{session:null},error:null};const t=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#getSession()",`session has${t?"":" not"} expired`,"expires_at",e.expires_at),!t)return{data:{session:e},error:null};const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}}finally{this._debug("#getSession()","end")}})}getUser(e){var t,r;return w(this,void 0,void 0,function*(){try{if(!e){const{data:s,error:i}=yield this.getSession();if(i)throw i;e=(r=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:void 0}return yield O(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ae})}catch(s){if(k(s))return{data:{user:null},error:s};throw s}})}updateUser(e,t={}){return w(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();if(s)throw s;if(!r.session)throw new fe;const i=r.session,{data:o,error:a}=yield O(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:e,jwt:i.access_token,xform:ae});if(a)throw a;return i.user=o.user,yield this._saveSession(i),yield this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}_decodeJWT(e){return wt(e)}setSession(e){return w(this,void 0,void 0,function*(){try{if(!e.access_token||!e.refresh_token)throw new fe;const t=Date.now()/1e3;let r=t,s=!0,i=null;const o=wt(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:c}=yield this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:c}=yield this.getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(i),yield this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(k(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){var t;return w(this,void 0,void 0,function*(){try{if(!e){const{data:i,error:o}=yield this.getSession();if(o)throw o;e=(t=i.session)!==null&&t!==void 0?t:void 0}if(!(e!=null&&e.refresh_token))throw new fe;const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}catch(r){if(k(r))return{data:{user:null,session:null},error:r};throw r}})}_getSessionFromUrl(e){return w(this,void 0,void 0,function*(){try{if(!W())throw new V("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new V("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Ve("Not a valid PKCE flow url.");if(e){const S=M("code");if(!S)throw new Ve("No code detected.");const{data:C,error:j}=yield this.exchangeCodeForSession(S);if(j)throw j;if(!C.session)throw new Ve("No session detected.");let R=new URL(window.location.href);return R.searchParams.delete("code"),window.history.replaceState(window.history.state,"",R.toString()),{data:{session:C.session,redirectType:null},error:null}}const t=M("error_description");if(t){const S=M("error_code");if(!S)throw new V("No error_code detected.");const C=M("error");throw C?new V(t,{error:C,code:S}):new V("No error detected.")}const r=M("provider_token"),s=M("provider_refresh_token"),i=M("access_token");if(!i)throw new V("No access_token detected.");const o=M("expires_in");if(!o)throw new V("No expires_in detected.");const a=M("refresh_token");if(!a)throw new V("No refresh_token detected.");const c=M("token_type");if(!c)throw new V("No token_type detected.");const l=Math.round(Date.now()/1e3)+parseInt(o),{data:f,error:v}=yield this.getUser(i);if(v)throw v;const m=f.user,g={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:parseInt(o),expires_at:l,refresh_token:a,token_type:c,user:m},_=M("type");return window.location.hash="",this._debug("#_getSessionFromUrl()","clearing window.location.hash"),{data:{session:g,redirectType:_},error:null}}catch(t){if(k(t))return{data:{session:null,redirectType:null},error:t};throw t}})}_isImplicitGrantFlow(){return W()&&(!!M("access_token")||!!M("error_description"))}_isPKCEFlow(){return w(this,void 0,void 0,function*(){const e=yield Pe(this.storage,`${this.storageKey}-code-verifier`);return!!M("code")&&!!e})}signOut({scope:e}={scope:"global"}){var t;return w(this,void 0,void 0,function*(){const{data:r,error:s}=yield this.getSession();if(s)return{error:s};const i=(t=r.session)===null||t===void 0?void 0:t.access_token;if(i){const{error:o}=yield this.admin.signOut(i,e);if(o&&!(ji(o)&&(o.status===404||o.status===401)))return{error:o}}return e!=="others"&&(yield this._removeSession(),yield Je(this.storage,`${this.storageKey}-code-verifier`),yield this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=Si(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),this._emitInitialSession(t),{data:{subscription:r}}}_emitInitialSession(e){var t,r;return w(this,void 0,void 0,function*(){try{const{data:{session:s},error:i}=yield this.getSession();if(i)throw i;yield(t=this.stateChangeEmitters.get(e))===null||t===void 0?void 0:t.callback("INITIAL_SESSION",s),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){yield(r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}resetPasswordForEmail(e,t={}){return w(this,void 0,void 0,function*(){let r=null,s=null;if(this.flowType==="pkce"){const i=je();yield we(this.storage,`${this.storageKey}-code-verifier`,i),r=yield Re(i),s=i===r?"plain":"s256"}try{return yield O(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(k(i))return{data:null,error:i};throw i}})}_refreshAccessToken(e){return w(this,void 0,void 0,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return yield Ai(s=>w(this,void 0,void 0,function*(){return yield Oi(s*200),this._debug(t,"refreshing attempt",s),yield O(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Y})}),(s,i,o)=>o&&o.error&&Tt(o.error)&&Date.now()+(s+1)*200-r<De)}catch(r){if(this._debug(t,"error",r),k(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return w(this,void 0,void 0,function*(){const r=yield this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),W()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){var e;return w(this,void 0,void 0,function*(){const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=yield Pe(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&(yield this._removeSession());return}const s=Math.round(Date.now()/1e3),i=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<s+kt;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${kt}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=yield this._callRefreshToken(r.refresh_token);o&&(console.error(o),Tt(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),yield this._removeSession()))}}else yield this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}})}_callRefreshToken(e){var t,r;return w(this,void 0,void 0,function*(){if(!e)throw new fe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Ne;const{data:i,error:o}=yield this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new fe;yield this._saveSession(i.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),k(i)){const o={session:null,error:i};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}})}_notifyAllSubscribers(e,t,r=!0){return w(this,void 0,void 0,function*(){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(a=>w(this,void 0,void 0,function*(){try{yield a.callback(e,t)}catch(c){i.push(c)}}));if(yield Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}})}_saveSession(e){return w(this,void 0,void 0,function*(){this._debug("#_saveSession()",e),this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&(yield this._persistSession(e))})}_persistSession(e){return this._debug("#_persistSession()",e),we(this.storage,this.storageKey,e)}_removeSession(){return w(this,void 0,void 0,function*(){this._debug("#_removeSession()"),this.persistSession?yield Je(this.storage,this.storageKey):this.inMemorySession=null})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&W()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return w(this,void 0,void 0,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),De);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),yield this._autoRefreshTokenTick()})}_stopAutoRefresh(){return w(this,void 0,void 0,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return w(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return w(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return w(this,void 0,void 0,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{const e=Date.now();try{const{data:{session:t}}=yield this.getSession();if(!t||!t.refresh_token||!t.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((t.expires_at*1e3-e)/De);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${De}ms, refresh threshold is ${Ot} ticks`),r<=Ot&&(yield this._callRefreshToken(t.refresh_token))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}_handleVisibilityChange(){return w(this,void 0,void 0,function*(){if(this._debug("#_handleVisibilityChange()"),!W()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>w(this,void 0,void 0,function*(){return yield this._onVisibilityChanged(!1)}),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return w(this,void 0,void 0,function*(){this._debug(`#_onVisibilityChanged(${e})`,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(e||(yield this.initializePromise,yield this._recoverAndRefresh(),this._debug("#_onVisibilityChanged()","finished waiting for initialize, _recoverAndRefresh")),this.autoRefreshToken&&this._startAutoRefresh()):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t){return w(this,void 0,void 0,function*(){const r=[`provider=${encodeURIComponent(e)}`];if(t!=null&&t.redirectTo&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t!=null&&t.scopes&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),this.flowType==="pkce"){const s=je();yield we(this.storage,`${this.storageKey}-code-verifier`,s);const i=yield Re(s),o=s===i?"plain":"s256";this._debug("PKCE","code verifier",`${s.substring(0,5)}...`,"code challenge",i,"method",o);const a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(a.toString())}if(t!=null&&t.queryParams){const s=new URLSearchParams(t.queryParams);r.push(s.toString())}return`${this.url}/authorize?${r.join("&")}`})}_unenroll(e){var t;return w(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();return s?{data:null,error:s}:yield O(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(k(r))return{data:null,error:r};throw r}})}_enroll(e){var t,r;return w(this,void 0,void 0,function*(){try{const{data:s,error:i}=yield this.getSession();if(i)return{data:null,error:i};const{data:o,error:a}=yield O(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(t=s==null?void 0:s.session)===null||t===void 0?void 0:t.access_token});return a?{data:null,error:a}:(!((r=o==null?void 0:o.totp)===null||r===void 0)&&r.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}catch(s){if(k(s))return{data:null,error:s};throw s}})}_verify(e){var t;return w(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();if(s)return{data:null,error:s};const{data:i,error:o}=yield O(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token});return o?{data:null,error:o}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})}catch(r){if(k(r))return{data:null,error:r};throw r}})}_challenge(e){var t;return w(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();return s?{data:null,error:s}:yield O(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(k(r))return{data:null,error:r};throw r}})}_challengeAndVerify(e){return w(this,void 0,void 0,function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return w(this,void 0,void 0,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(i=>i.factor_type==="totp"&&i.status==="verified");return{data:{all:r,totp:s},error:null}})}_getAuthenticatorAssuranceLevel(){var e,t;return w(this,void 0,void 0,function*(){const{data:{session:r},error:s}=yield this.getSession();if(s)return{data:null,error:s};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const i=this._decodeJWT(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((t=(e=r.user.factors)===null||e===void 0?void 0:e.filter(l=>l.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const h=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:h},error:null}})}}Oe.nextInstanceID=0;class Wi extends Oe{constructor(e){super(e)}}var Yi=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(f){o(f)}}function c(l){try{h(r.throw(l))}catch(f){o(f)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const Xi={headers:vi},Zi={schema:"public"},Qi={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},es={};class ts{constructor(e,t,r){var s,i,o,a,c,h,l,f;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const v=_i(e);this.realtimeUrl=`${v}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${v}/auth/v1`,this.storageUrl=`${v}/storage/v1`,this.functionsUrl=`${v}/functions/v1`;const m=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,g={db:Zi,realtime:es,auth:Object.assign(Object.assign({},Qi),{storageKey:m}),global:Xi},_=wi(r??{},g);this.storageKey=(i=(s=_.auth)===null||s===void 0?void 0:s.storageKey)!==null&&i!==void 0?i:"",this.headers=(a=(o=_.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((c=_.auth)!==null&&c!==void 0?c:{},this.headers,(h=_.global)===null||h===void 0?void 0:h.fetch),this.fetch=bi(t,this._getAccessToken.bind(this),(l=_.global)===null||l===void 0?void 0:l.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},_.realtime)),this.rest=new wr(`${v}/rest/v1`,{headers:this.headers,schema:(f=_.db)===null||f===void 0?void 0:f.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new fr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new fi(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Yi(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o},a,c){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Wi({url:this.authUrl,headers:Object.assign(Object.assign({},h),a),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,fetch:c})}_initRealtimeClient(e){return new ri(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const rs=(n,e,t)=>new ts(n,e,t),is="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZjbWt5ZmtpaWJseG1iZ3d1ZWdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDA2OTg1MDYsImV4cCI6MjAxNjI3NDUwNn0.HQpd365K70NNtHTbonYY5xDlsLyp859awNswcOn-fCc",ss="pk.eyJ1Ijoic3RhaGxzdHJhZGFtdXMiLCJhIjoiY2xvZWNrMGxjMDFldzJqczZ2b2g1c2FldCJ9.MQaEas9L_03YCaFbaO-SBA";function ns(n){let e,t,r,s,i='<span class="svelte-f9br40">NYPL Environmental Health &amp; Safety Map</span>',o,a,c="<span>Last Updated: 6/11/2024</span>",h,l,f,v=n[1].toFixed(4)+"",m,g,_=n[2].toFixed(4)+"",S,C,j=n[3].toFixed(2)+"",R,P,N,Z;return{c(){e=ie("section"),t=ie("div"),r=xe(),s=ie("div"),s.innerHTML=i,o=xe(),a=ie("div"),a.innerHTML=c,h=xe(),l=ie("div"),f=ee("Longitude: "),m=ee(v),g=ee(" | Latitude: "),S=ee(_),C=ee(" | Zoom: "),R=ee(j),P=xe(),N=ie("br"),Z=ee(`v:
		0.0.7a`),this.h()},l(F){e=se(F,"SECTION",{class:!0});var $=Le(e);t=se($,"DIV",{class:!0}),Le(t).forEach(ve),r=$e($),s=se($,"DIV",{class:!0,["data-svelte-h"]:!0}),dt(s)!=="svelte-18idny7"&&(s.innerHTML=i),o=$e($),a=se($,"DIV",{class:!0,["data-svelte-h"]:!0}),dt(a)!=="svelte-h6ve3f"&&(a.innerHTML=c),h=$e($),l=se($,"DIV",{class:!0});var B=Le(l);f=te(B,"Longitude: "),m=te(B,v),g=te(B," | Latitude: "),S=te(B,_),C=te(B," | Zoom: "),R=te(B,j),P=$e(B),N=se(B,"BR",{}),Z=te(B,`v:
		0.0.7a`),B.forEach(ve),$.forEach(ve),this.h()},h(){_e(t,"class","svelte-f9br40"),_e(s,"class","header-bg svelte-f9br40"),_e(a,"class","svelte-f9br40"),_e(l,"class","sidebar svelte-f9br40"),_e(e,"class","svelte-f9br40")},m(F,$){$t(F,e,$),L(e,t),n[4](t),L(e,r),L(e,s),L(e,o),L(e,a),L(e,h),L(e,l),L(l,f),L(l,m),L(l,g),L(l,S),L(l,C),L(l,R),L(l,P),L(l,N),L(l,Z)},p(F,[$]){$&2&&v!==(v=F[1].toFixed(4)+"")&&Fe(m,v),$&4&&_!==(_=F[2].toFixed(4)+"")&&Fe(S,_),$&8&&j!==(j=F[3].toFixed(2)+"")&&Fe(R,j)},i:We,o:We,d(F){F&&ve(e),n[4](null)}}}const os="https://fcmkyfkiiblxmbgwuegf.supabase.co";function as(n,e,t){const s=rs(os,is,{auth:{persistSession:!1}});let i,o,a,c,h;a=-74,c=40.7,h=10;function l(){t(3,h=o.getZoom()),t(1,a=o.getCenter().lng),t(2,c=o.getCenter().lat)}Xt(async()=>{{let Nt=function(A){return new Promise(D=>{if(document.querySelector(A))return D(document.querySelector(A));new MutationObserver(lt=>{document.querySelector(A)&&D(document.querySelector(A))}).observe(document.querySelector("#layerTree"),{attributes:!0,childList:!0,subtree:!1,characterData:!1})})};const b=await K(()=>import("./leaflet-src.cf8869b0.js").then(A=>A.l),[],import.meta.url);await K(()=>import("./L.Control.Locate.b09a5e38.js").then(A=>A.L),["./L.Control.Locate.b09a5e38.js","./leaflet-src.cf8869b0.js"],import.meta.url),await K(()=>import("./L.Control.Layers.Tree.9578f986.js"),[],import.meta.url),await K(()=>Promise.resolve({}),["../assets/L.Control.Layers.Tree.87139324.css"],import.meta.url),await K(()=>Promise.resolve({}),["../assets/leaflet-search.src.f6f51e47.css"],import.meta.url),await K(()=>import("./leaflet-search.src.159a1f10.js").then(A=>A.l),["./leaflet-search.src.159a1f10.js","./leaflet-src.cf8869b0.js"],import.meta.url),window.innerWidth<800?t(3,h=10):t(3,h=11);const E={lng:a,lat:c,zoom:h};o=b.map(i,{zoomControl:!0,maxZoom:25,minZoom:10}).setView([E.lat,E.lng],E.zoom),o.setMaxBounds(o.getBounds());var v=ss,m=b.tileLayer("https://api.mapbox.com/styles/v1/stahlstradamus/clrb4kx8p005v01qo3vaef7k7/tiles/{z}/{x}/{y}?access_token="+v,{attribution:'Â© <a href="https://www.mapbox.com/contribute/">Mapbox</a> Â© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:25}),g=b.tileLayer("https://api.mapbox.com/styles/v1/stahlstradamus/clrb52eso006901pi7jv416qa/tiles/{z}/{x}/{y}?access_token="+v,{attribution:'Â© <a href="https://www.mapbox.com/contribute/">Mapbox</a> Â© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:25}).addTo(o);o.on("move",()=>{l()});var _={label:"Base Maps",children:[{label:"Light Theme",layer:m},{label:"Dark Theme",layer:g}]},S={collapseAll:"",collapsed:!1};document.addEventListener("keypress",A=>{if(A.code=="Backquote"){console.log("wow!");var D=document.querySelector(".sidebar");D.style.zIndex<=0?D.style.zIndex=999:D.style.zIndex=-1}});var C=b.featureGroup(),j=b.featureGroup(),R=b.featureGroup(),P=b.featureGroup(),N=b.featureGroup(),Z=b.featureGroup(),F=b.featureGroup(),$=b.featureGroup();b.featureGroup();var B=b.featureGroup(),Ae=b.featureGroup(),H=b.featureGroup(),Ce=b.featureGroup(),me=b.featureGroup(),d=b.featureGroup();async function ce(){const{data:A}=await s.from("libraries").select("*");return{libraries:A??[]}}var p=18,T;o.on("zoomend",function(){var A=o.getZoom();A<p&&(!T||T>=p)?o.eachLayer(function(D){if(D.getTooltip()){var he=D.getTooltip();D.unbindTooltip().bindTooltip(he,{permanent:!1})}}):A>=p&&(!T||T<p)&&o.eachLayer(function(D){if(D.getTooltip()){var he=D.getTooltip();D.unbindTooltip().bindTooltip(he,{permanent:!0})}}),T=A});async function Q(A,D){var he=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/branch.svg",iconSize:[15,15]}),lt=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/SASB.svg",iconSize:[15,15]}),Ft=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/LPA.svg",iconSize:[15,15]}),Ht=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/Burg.svg",iconSize:[15,15]}),Gt=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/LSC.svg",iconSize:[15,15]}),qt=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/270mad.svg",iconSize:[15,15]});let u=[];var ct=new b.LayerGroup;A.addLayer(ct),D.libraries.forEach((y,ds)=>{var de=b.tooltip([y.Y,y.X],{content:y.name,permanent:!1,direction:"auto",offset:[10,0]});y.code==="SASB"?u[y.code]=b.marker([y.Y,y.X],{icon:lt,title:y.code}).bindTooltip(de).openTooltip():y.code==="LPA"?u[y.code]=b.marker([y.Y,y.X],{icon:Ft,title:y.code}).bindTooltip(de).openTooltip():y.code==="SCH"?u[y.code]=b.marker([y.Y,y.X],{icon:Ht,title:y.code}).bindTooltip(de).openTooltip():y.code==="LSC"?u[y.code]=b.marker([y.Y,y.X],{icon:Gt,title:y.code}).bindTooltip(de).openTooltip():y.code==="TN"?u[y.code]=b.marker([y.Y,y.X],{icon:qt,title:y.code}).bindTooltip(de).openTooltip():u[y.code]=b.marker([y.Y,y.X],{icon:he,title:y.code}).bindTooltip(de).openTooltip(),y.status==="Closed"&&u[y.code].setOpacity(.25),u[y.code].alt=y.name,y.network==="W-BX"?u[y.code].addTo(C):y.network==="C-BX"?u[y.code].addTo(j):y.network==="E-BX"?u[y.code].addTo(R):y.network==="W-MH"?u[y.code].addTo(P):y.network==="E-MH"?u[y.code].addTo(N):y.network==="L-MH"?u[y.code].addTo(Z):y.network==="SI"?u[y.code].addTo(F):y.network,y.name!=null&&u[y.code].addTo($),y.aed_check!=!0&&u[y.code].addTo(B),y.ehs_inspection==="JTS"&&u[y.code].addTo(Ae),y.roof_inventory==="JTS"&&u[y.code].addTo(H),y.mewp_inventory==="JTS"&&u[y.code].addTo(Ce),y.hvac_inspections==="JTS"&&u[y.code].addTo(me);var Wt=`
										<table>
					  <thead>
					    <tr>
					      <th colspan="2" style="padding-bottom:1em; font-size:large;">${y.name}</th>
					    </tr>
					  </thead>
					  <tbody>
						<tr>
							<td style="text-align: right">Address: </td>
							<td>${y.housenum} ${y.streetname}</td>
					    <tr>
					      <td style="text-align: right">Network: </td>
					      <td>${y.network}</td>
					    </tr>
					    <tr>

					      <td style="padding-bottom: 1em; text-align: right">Code: </td>
					      <td style="padding-bottom: 1em">${y.code}</td>
					    </tr>
					    <tr>
					      <td style="padding-bottom: 1em; text-align: right">Status: </td>
					      <td style="padding-bottom: 1em">${y.status}</td>
					    </tr>
					    <tr>
					      <td style="text-align: right">Coordinator: </td>
					      <td>${y.coordinator}</td>
					    </tr>
						<tr>
							<td style="text-align: right">AED Inspected: </td>
					    	<td><label class="toggle"> <input type="checkbox">
								<div class="slide-toggle"></div></label>
							</td>
						</tr>
					  </tbody>
					</table>
					
										`;u[y.code].bindPopup(Wt),Nt("#layerTree").then(us=>{var Yt=document.querySelectorAll('input[name="radio"]');Yt[3].addEventListener("input",()=>{y.ehs_inspection==="JTS"&&(u[y.code]._icon.style.filter="brightness(0) saturate(100%) invert(58%) sepia(28%) saturate(257%) hue-rotate(242deg) brightness(83%) contrast(80%)")})})}),A.addControl(new b.Control.Search({layer:ct,initial:!1,zoom:17,marker:!1}));var zt={label:"Branches",layer:$,radioGroup:"radio",children:[{label:"Networks",children:[{label:"Bronx",collapsed:!0,children:[{label:"West Bronx",selectAllCheckbox:!0,collapsed:!0,children:[{label:"Francis Martin",layer:u.FXR},{label:"Grand Concourse",layer:u.GD},{label:"High Bridge",layer:u.HB},{label:"Jerome Park",layer:u.JP},{label:"Kingsbridge",layer:u.KBR},{label:"Melrose",layer:u.ME},{label:"Mosholu",layer:u.MO},{label:"Riverdale",layer:u.RD},{label:"Sedgwick",layer:u.SD},{label:"Spuyten Duyvil",layer:u.DY},{label:"Van Cortlandt",layer:u.VC},{label:"Woodlawn Heights",layer:u.WL}]},{label:"Central Bronx",selectAllCheckbox:!0,collapsed:!0,children:[{label:"Allerton",layer:u.AL},{label:"Belmont",layer:u.BER},{label:"Bronx Library Center",layer:u.BLC},{label:"Clasons's Point",layer:u.CP},{label:"Hunt's Point",layer:u.HSR},{label:"Morris Park",layer:u.MP},{label:"Morrisania",layer:u.MR},{label:"Mott Haven",layer:u.MH},{label:"Pelham Parkway-Van Nest",layer:u.VN},{label:"Tremont",layer:u.TM},{label:"West Farms",layer:u.WF},{label:"Woodstock",layer:u.WO}]},{label:"East Bronx",selectAllCheckbox:!0,collapsed:!0,children:[{label:"Baychester",layer:u.BAR},{label:"Castle Hill",layer:u.CT},{label:"City Island",layer:u.CI},{label:"Eastchester",layer:u.EA},{label:"Edenwald",layer:u.EW},{label:"Parkchester",layer:u.PKR},{label:"Pelham Bay",layer:u.PM},{label:"Soundview",layer:u.SV},{label:"Throg's Neck",layer:u.TG},{label:"Wakefield",layer:u.WK},{label:"Westchester Square",layer:u.WT}]}]},{label:"Manhattan",collapsed:!0,children:[{label:"West Manhattan",selectAllCheckbox:!0,collapsed:!0,children:[{label:"115th St",layer:u.HU},{label:"Bloomingdale",layer:u.BLR},{label:"Columbus",layer:u.CS},{label:"Fort Washington",layer:u.FW},{label:"George Bruce",layer:u.BR},{label:"Hamilton Grange",layer:u.HG},{label:"Inwood",layer:u.INR},{label:"Macomb's Bridge",layer:u.MB},{label:"Morningside Heights",layer:u.CL},{label:"Muhlenberg",layer:u.MU},{label:"Riverside",layer:u.R},{label:"St. Agnes",layer:u.SA},{label:"Washington Heights",layer:u.WH}]},{label:"East Manhattan",selectAllCheckbox:!0,collapsed:!0,children:[{label:"125th St",layer:u.HD},{label:"53rd St",layer:u["53STR"]},{label:"58th St",layer:u.FE},{label:"67th St",layer:u.SS},{label:"96th St",layer:u.NRS},{label:"Aguilar",layer:u.AG},{label:"Countee Cullen",layer:u.CC},{label:"Harlem",layer:u.HL},{label:"Roosevelt Island",layer:u.RI},{label:"Cathedral",layer:u.CA},{label:"Webster",layer:u.WB},{label:"Yorkville",layer:u.YV}]},{label:"Lower Manhattan",selectAllCheckbox:!0,collapsed:!0,children:[{label:"Andrew Heiskell",layer:u.LB},{label:"Battery Park",layer:u.BPC},{label:"Chatham Square",layer:u.CHR},{label:"Epiphany",layer:u.EP},{label:"Hamilton Fish Park",layer:u.HF},{label:"Hudson Park",layer:u.HP},{label:"Jefferson Market",layer:u.JMR},{label:"Kips Bay",layer:u.KP},{label:"Mulberry St",layer:u.ML},{label:"New Amsterdam",layer:u.LM},{label:"Ottendorfer",layer:u.OT},{label:"Seward Park",layer:u.SE},{label:"Tompkin's Square",layer:u.TS}]}]},{label:"Staten Island",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Charleston",layer:u.CN},{label:"Dongan Hills",layer:u.DH},{label:"Great Kills",layer:u.GK},{label:"Huguenot Park",layer:u.HK},{label:"Mariners Harbor",layer:u.MN},{label:"New Dorp",layer:u.NDR},{label:"Port Richmond",layer:u.PR},{label:"Richmondtown",layer:u.RT},{label:"South Beach",layer:u.SB},{label:"St. George",layer:u.SGC},{label:"Stapleton",layer:u.ST},{label:"Todt Hill-Westerleigh",layer:u.THR},{label:"Tottenville",layer:u.TV},{label:"West New Brighton",layer:u.NB}]},{label:"Admin",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Library Services Center",layer:u.LSC},{label:"Library for The Performing Arts",layer:u.LPA},{label:"Schomburg",layer:u.SCH},{label:"Stavros Niarchos",layer:u.SNFL},{label:"Stephen A Schwartzman",layer:u.SASB},{label:"270 Madison",layer:u.TN}]}]},{label:"Projects",selectAllCheckbox:!1,collapsed:!1,children:[{label:"",layer:d,radioGroup:"radio"},{label:"AEDs",layer:B,radioGroup:"radio"},{label:"EHS Inspection",layer:Ae,radioGroup:"radio"},{label:"Roof Inventory",layer:H,radioGroup:"radio"},{label:"MEWP Inventory",layer:Ce,radioGroup:"radio"}]}]};b.control.layers.tree(_,zt,S).addTo(A);var Jt=document.querySelector("body > div > main > section > div > div.leaflet-control-container > div.leaflet-top.leaflet-right > div > section"),Kt='<div><img class="layerControlToggle" style="float:right;" src="https://raw.githubusercontent.com/stahlnypl/NYPLEHSMAP/main/static/Data/images/lct_button.png"></div>';Jt.insertAdjacentHTML("afterbegin",Kt);var Vt=document.querySelector("body > div > main > section > div > div.leaflet-control-container > div.leaflet-top.leaflet-right > div > section > div:nth-child(1)");Vt.addEventListener("click",()=>{document.querySelector("div.header-bg > span").removeAttribute("leaflet-control-layers-expanded"),document.querySelector("body > div > main > section > div > div.leaflet-control-container > div.leaflet-top.leaflet-right > div").setAttribute("class","leaflet-control-layers leaflet-control-layers-collapsed leaflet-control")});var ht=document.querySelector("div.header-bg");A.on("baselayerchange",function(y){console.log(y),y.name==="0"?(document.querySelector("body > div > main > section > div.header-bg > span").style.color="#415462",console.log("light theme")):(document.querySelector("body > div > main > section > div.header-bg > span").style.color="#dfdfdf",console.log("dark theme"))}),ht.addEventListener("click",()=>{document.querySelector("body > div > main > section").removeChild(ht),console.log("Title Span Clicked!")})}async function be(){try{const A=await ce();Q(o,A)}catch(A){console.error("Error: ",A)}}be();var I=document.querySelector("div.leaflet-control-container > div.leaflet-top.leaflet-right");I.setAttribute("id","layerTree"),b.control.locate({icon:"leaflet-control-locate-location-arrow",initialZoomLevel:18}).addTo(o)}}),Zt(async()=>{o&&(console.log("Unloading Leaflet map."),o.remove())});function f(v){Qt[v?"unshift":"push"](()=>{i=v,t(0,i)})}return[i,a,c,h,f]}class ls extends Ct{constructor(e){super(),xt(this,e,as,ns,At,{})}}function cs(n){let e,t,r;return t=new ls({}),{c(){e=ie("main"),er(t.$$.fragment)},l(s){e=se(s,"MAIN",{});var i=Le(e);tr(t.$$.fragment,i),i.forEach(ve)},m(s,i){$t(s,e,i),rr(t,e,null),r=!0},p:We,i(s){r||(ir(t.$$.fragment,s),r=!0)},o(s){sr(t.$$.fragment,s),r=!1},d(s){s&&ve(e),nr(t)}}}class gs extends Ct{constructor(e){super(),xt(this,e,null,cs,At,{})}}export{gs as P,pr as c,vr as g};
